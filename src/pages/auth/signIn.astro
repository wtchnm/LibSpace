---
export const prerender = false

import { actions } from 'astro:actions'
import Button from '@/components/Button.astro'
import Input from '@/components/Input.astro'
import Link from '@/components/Link.astro'
import Base from '@/layouts/Base.astro'
import { _redirectWithHeaders } from '@/lib/utils'

const result = Astro.getActionResult(actions.auth.signIn)
if (result && !result.error) return _redirectWithHeaders(result.data.headers)
---

<Base>
	<main class='flex flex-grow flex-col items-center justify-center gap-8 px-4'>
		<h1 class='text-2xl font-bold'>Login</h1>

		<form
			method='POST'
			action={actions.auth.signIn}
			class='flex flex-col gap-6'
		>
			<Input type='email' name='email' label='E-mail' autofocus required />
			<Input
				type='password'
				name='password'
				label='Password'
				minlength={8}
				maxlength={128}
				required
			/>

			{
				result?.error && (
					<p class='text-center text-red-500'>{result.error.message}</p>
				)
			}
			<div class='flex flex-col gap-2'>
				<Button type='submit'>Sign in</Button>
				<Link href='/auth/signUp'>Sign up</Link>
			</div>
		</form>
	</main>
</Base>
